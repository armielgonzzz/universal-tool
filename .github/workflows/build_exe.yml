name: Build and Release Universal Tool

on:
  push:
    tags:
      - '*'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v2

      # Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      # Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Install PyInstaller and create the .exe with the new name
      - name: Build executable
        run: |
          pip install pyinstaller
          pyinstaller --onefile main.py
      
      # Debug: List files in the dist directory to check if the .exe was created
      - name: Check if .exe exists in dist folder
        run: ls -la dist/main
          
      # Rename the .exe file to Universal Tool.exe and archive it
      - name: Rename and archive the .exe
        run: |
          mkdir -p release
          mv dist/main/main.exe "release/CM Tools.exe"

      # Upload the renamed .exe file to GitHub Releases
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: "release/CM Tools.exe"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
